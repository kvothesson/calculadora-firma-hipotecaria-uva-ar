class URLStateService{constructor(){this.paramsToTrack=["monto","plazo","tasa","provincia","sueldo","valorPropiedad","escritura","inmobiliaria","firmas","sellos"]}serializeStateToURL(e){try{const a=new URL(window.location),t=new URLSearchParams;return e.monto&&t.set("monto",e.monto),e.plazo&&t.set("plazo",e.plazo),e.tasa&&t.set("tasa",e.tasa),e.provincia&&t.set("provincia",e.provincia),e.sueldo&&t.set("sueldo",e.sueldo),e.valorPropiedad&&t.set("valorPropiedad",e.valorPropiedad),e.escritura&&t.set("escritura",e.escritura),e.inmobiliaria&&t.set("inmobiliaria",e.inmobiliaria),e.firmas&&t.set("firmas",e.firmas),e.sellos&&t.set("sellos",e.sellos),t.toString()&&(a.search=t.toString(),window.history.replaceState({},"",a),console.log("ðŸ”— Estado serializado a URL:",a.toString())),a.toString()}catch(e){return console.error("âŒ Error al serializar estado a URL:",e),window.location.href}}deserializeStateFromURL(){try{const e=new URL(window.location),a=new URLSearchParams(e.search),t={};return a.has("monto")&&(t.monto=parseFloat(a.get("monto"))),a.has("plazo")&&(t.plazo=parseInt(a.get("plazo"))),a.has("tasa")&&(t.tasa=parseFloat(a.get("tasa"))),a.has("provincia")&&(t.provincia=a.get("provincia")),a.has("sueldo")&&(t.sueldo=parseFloat(a.get("sueldo"))),a.has("valorPropiedad")&&(t.valorPropiedad=parseFloat(a.get("valorPropiedad"))),a.has("escritura")&&(t.escritura=parseFloat(a.get("escritura"))),a.has("inmobiliaria")&&(t.inmobiliaria=parseFloat(a.get("inmobiliaria"))),a.has("firmas")&&(t.firmas=parseFloat(a.get("firmas"))),a.has("sellos")&&(t.sellos=parseFloat(a.get("sellos"))),console.log("ðŸ”— Estado deserializado desde URL:",t),t}catch(e){return console.error("âŒ Error al deserializar estado desde URL:",e),{}}}applyStateToForm(e){try{if(e.monto&&document.getElementById("montoPrestamo")&&(document.getElementById("montoPrestamo").value=e.monto),e.plazo&&document.getElementById("plazo")){document.getElementById("plazo").value=e.plazo;const a=document.getElementById("plazoValor");a&&(a.textContent=e.plazo)}if(e.tasa&&document.getElementById("tasaInteres")){document.getElementById("tasaInteres").value=e.tasa;const a=document.getElementById("tasaValor");a&&(a.textContent=e.tasa)}return e.provincia&&document.getElementById("provincia")&&(document.getElementById("provincia").value=e.provincia),e.sueldo&&document.getElementById("sueldoMensual")&&(document.getElementById("sueldoMensual").value=e.sueldo),e.valorPropiedad&&document.getElementById("valorPropiedad")&&(document.getElementById("valorPropiedad").value=e.valorPropiedad),e.escritura&&document.getElementById("escrituraSlider")&&(document.getElementById("escrituraSlider").value=e.escritura),e.inmobiliaria&&document.getElementById("inmobiliariaSlider")&&(document.getElementById("inmobiliariaSlider").value=e.inmobiliaria),e.firmas&&document.getElementById("firmasSlider")&&(document.getElementById("firmasSlider").value=e.firmas),e.sellos&&document.getElementById("sellosSlider")&&(document.getElementById("sellosSlider").value=e.sellos),console.log("âœ… Estado aplicado al formulario"),!0}catch(e){return console.error("âŒ Error al aplicar estado al formulario:",e),!1}}getCurrentFormState(){try{const e={},a=document.getElementById("montoPrestamo"),t=document.getElementById("plazo"),o=document.getElementById("tasaInteres"),r=document.getElementById("provincia"),l=document.getElementById("sueldoMensual"),i=document.getElementById("valorPropiedad");a&&a.value&&(e.monto=parseFloat(a.value)),t&&t.value&&(e.plazo=parseInt(t.value)),o&&o.value&&(e.tasa=parseFloat(o.value)),r&&r.value&&(e.provincia=r.value),l&&l.value&&(e.sueldo=parseFloat(l.value)),i&&i.value&&(e.valorPropiedad=parseFloat(i.value));const n=document.getElementById("escrituraSlider"),s=document.getElementById("inmobiliariaSlider"),d=document.getElementById("firmasSlider"),c=document.getElementById("sellosSlider");return n&&n.value&&(e.escritura=parseFloat(n.value)),s&&s.value&&(e.inmobiliaria=parseFloat(s.value)),d&&d.value&&(e.firmas=parseFloat(d.value)),c&&c.value&&(e.sellos=parseFloat(c.value)),e}catch(e){return console.error("âŒ Error al obtener estado del formulario:",e),{}}}async copySimulationURL(){try{const e=this.getCurrentFormState(),a=this.serializeStateToURL(e);return await navigator.clipboard.writeText(a),this.showCopyFeedback(),console.log("ðŸ“‹ URL de simulaciÃ³n copiada:",a),a}catch(e){console.error("âŒ Error al copiar URL:",e),this.fallbackCopyURL()}}showCopyFeedback(){let e=document.getElementById("shareSimulationButton");if(!e){e=document.createElement("button"),e.id="shareSimulationButton",e.className="share-button",e.innerHTML="ðŸ“‹ Compartir simulaciÃ³n",e.onclick=()=>this.copySimulationURL();const a=document.querySelector("header");a&&a.appendChild(e)}const a=e.innerHTML;e.innerHTML="âœ… Â¡Copiado!",e.style.background="#22c55e",setTimeout(()=>{e.innerHTML=a,e.style.background=""},2e3)}fallbackCopyURL(){const e=this.getCurrentFormState(),a=this.serializeStateToURL(e),t=document.createElement("input");t.value=a,document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);try{document.execCommand("copy"),this.showCopyFeedback()}catch(e){console.error("Fallback copy failed:",e)}document.body.removeChild(t)}hasURLParams(){return new URL(window.location).search.length>0}}