class SimulatorController{constructor(e,t,a){this.exchangeRateService=e,this.calculationService=t,this.utilityService=a,this.inicializar()}inicializar(){this.configurarSliderTC(),this.configurarSliders(),this.actualizarBandasEnInterfaz()}configurarSliderTC(){const e=document.getElementById("tcInput"),t=document.querySelectorAll(".tc-suggestion");e&&(e.value=this.exchangeRateService.getTipoCambioOficial(),e.addEventListener("input",this.utilityService.debounce(e=>{this.manejarCambioTC(e.target.value)},300)),e.addEventListener("blur",e=>{this.validarRangoTC(e.target)})),this.configurarBotonesSugerencias(t)}manejarCambioTC(e){const t=parseInt(e);!isNaN(t)&&t>0&&(this.exchangeRateService.actualizarTipoCambioSimulador(t),this.recalcularCoreConNuevoTC(t),this.actualizarEstadoSugerencias(),this.validarTipoCambioConBandas(t))}validarRangoTC(e){let t=parseInt(e.value)||this.exchangeRateService.getTipoCambioOficial();t<800?(t=800,e.value=t):t>2e3&&(t=2e3,e.value=t),t!==this.exchangeRateService.getTipoCambioSimulador()&&(this.exchangeRateService.actualizarTipoCambioSimulador(t),this.recalcularCoreConNuevoTC(t),this.actualizarEstadoSugerencias())}configurarBotonesSugerencias(e){e.forEach(e=>{e.addEventListener("click",e=>{let t;switch(e.target.dataset.tc){case"oficial":default:t=this.exchangeRateService.getTipoCambioOficial();break;case"piso":t=this.exchangeRateService.calcularPisoBandaCambiaria().piso;break;case"techo":t=this.exchangeRateService.calcularBandasCambiarias().techo}const a=document.getElementById("tcInput");a&&(a.value=t),this.exchangeRateService.actualizarTipoCambioSimulador(t),this.recalcularCoreConNuevoTC(t),this.actualizarEstadoSugerencias(),this.validarTipoCambioConBandas(t)})})}recalcularCoreConNuevoTC(e){const t=this.obtenerDatosEntrada();if(!this.calculationService.validarDatosParaCalculos(t))return void console.log("recalcularCoreConNuevoTC: datos no v√°lidos",t);console.log("Recalculando CORE con nuevo TC:",e);const a=this.calculationService.calcularGastosExtraConTC(t.valorPropiedad,t.provincia,e),i=t.valorPropiedad*e+a.total;this.actualizarGastosDetallados(a,e),this.actualizarEscenariosTipoCambio(t,i,a),this.actualizarDiferenciaACubrir(i,t.montoPrestamo,e),this.actualizarEquivalenciaMontoPrestado(t.montoPrestamo,e),this.actualizarPrimeraCuotaUSD(t,e),this.actualizarTotalPagarUSD(i,e),console.log("CORE recalculado con TC:",e)}obtenerDatosEntrada(){return{valorPropiedad:this.utilityService.parsearNumero(document.getElementById("valorPropiedad")?.value,0),provincia:document.getElementById("provincia")?.value||"CABA",montoPrestamo:this.utilityService.parsearNumero(document.getElementById("montoPrestamo")?.value,0),plazo:parseInt(document.getElementById("plazo")?.value)||20,tasaInteres:this.utilityService.parsearNumero(document.getElementById("tasaInteres")?.value,8.5)}}actualizarGastosDetallados(e,t){this.utilityService.setLineaMoneda("gastoEscrituraARS","ARS",e.escritura),this.utilityService.setLineaMoneda("gastoEscrituraUSD","USD",e.escritura/t),this.utilityService.setLineaMoneda("gastoInmobiliariaARS","ARS",e.inmobiliaria),this.utilityService.setLineaMoneda("gastoInmobiliariaUSD","USD",e.inmobiliaria/t),this.utilityService.setLineaMoneda("gastoFirmasARS","ARS",e.firmas),this.utilityService.setLineaMoneda("gastoFirmasUSD","USD",e.firmas/t),this.utilityService.setLineaMoneda("gastoSellosARS","ARS",e.sellos),this.utilityService.setLineaMoneda("gastoSellosUSD","USD",e.sellos/t),this.utilityService.setLineaMoneda("gastosTotalARS","ARS",e.total,!0),this.utilityService.setLineaMoneda("gastosTotalUSD","USD",e.total/t,!0)}actualizarEscenariosTipoCambio(e,t,a){const i=this.exchangeRateService.calcularBandasCambiarias();this.actualizarEscenarioPiso(e,t,a,i.piso),this.actualizarEscenarioOficial(e,t,a),this.actualizarEscenarioTecho(e,t,a,i.techo)}actualizarEscenarioPiso(e,t,a,i){const o=e.valorPropiedad+a.total,r=o*i;this.utilityService.setLineaMoneda("totalPisoARS","ARS",r),this.utilityService.setLineaMoneda("totalPisoUSD","USD",o),this.utilityService.setLineaMoneda("prestamoPisoARS","ARS",e.montoPrestamo),this.utilityService.setLineaMoneda("prestamoPisoUSD","USD",e.montoPrestamo/i);const s=r-e.montoPrestamo;this.utilityService.setLineaMoneda("diferenciaPisoARS","ARS",s),this.utilityService.setLineaMoneda("diferenciaPisoUSD","USD",s/this.exchangeRateService.getTipoCambioOficial())}actualizarEscenarioOficial(e,t,a){const i=this.exchangeRateService.getTipoCambioOficial(),o=e.valorPropiedad+a.total,r=o*i;this.utilityService.setLineaMoneda("totalOficialARS","ARS",r),this.utilityService.setLineaMoneda("totalOficialUSD","USD",o),this.utilityService.setLineaMoneda("prestamoOficialARS","ARS",e.montoPrestamo),this.utilityService.setLineaMoneda("prestamoOficialUSD","USD",e.montoPrestamo/i);const s=r-e.montoPrestamo;this.utilityService.setLineaMoneda("diferenciaOficialARS","ARS",s),this.utilityService.setLineaMoneda("diferenciaOficialUSD","USD",s/i)}actualizarEscenarioTecho(e,t,a,i){const o=e.valorPropiedad+a.total,r=o*i;this.utilityService.setLineaMoneda("totalTechoARS","ARS",r),this.utilityService.setLineaMoneda("totalTechoUSD","USD",o),this.utilityService.setLineaMoneda("prestamoTechoARS","ARS",e.montoPrestamo),this.utilityService.setLineaMoneda("prestamoTechoUSD","USD",e.montoPrestamo/i);const s=r-e.montoPrestamo;this.utilityService.setLineaMoneda("diferenciaTechoARS","ARS",s),this.utilityService.setLineaMoneda("diferenciaTechoUSD","USD",s/this.exchangeRateService.getTipoCambioOficial())}actualizarDiferenciaACubrir(e,t,a){const i=e-t,o=i/a,r=document.getElementById("diferenciaACubrir"),s=document.getElementById("diferenciaACubrirUSD");r&&(r.textContent=this.utilityService.formatearARS(i)),s&&(s.textContent=`USD $${this.utilityService.formatearUSD(o)}`)}actualizarEquivalenciaMontoPrestado(e,t){const a=e/t,i=document.getElementById("montoPrestamoBancoUSD");i&&(i.textContent=`USD $${this.utilityService.formatearUSD(a)}`)}actualizarPrimeraCuotaUSD(e,t){const a=this.calculationService.calcularCuotaInicial(e.montoPrestamo,e.tasaInteres,e.plazo)/t,i=document.getElementById("primeraCuotaUSD");i&&(i.textContent=`USD $${this.utilityService.formatearUSD(a)}`)}actualizarTotalPagarUSD(e,t){const a=e/t,i=document.getElementById("totalPagarUSD");i&&(i.innerHTML=`<strong>USD $${this.utilityService.formatearUSD(a)}</strong>`)}actualizarEstadoSugerencias(){const e=document.getElementById("tcInput"),t=document.querySelectorAll(".tc-suggestion");if(!e)return;const a=parseInt(e.value);isNaN(a)||t.forEach(e=>{let t;switch(e.dataset.tc){case"oficial":t=this.exchangeRateService.getTipoCambioOficial();break;case"piso":t=this.exchangeRateService.calcularPisoBandaCambiaria().piso;break;case"techo":t=this.exchangeRateService.calcularBandasCambiarias().techo}Math.abs(a-t)<=5?e.classList.add("active"):e.classList.remove("active")})}validarTipoCambioConBandas(e){const t=this.exchangeRateService.validarTipoCambioConBandas(e);t.mensaje&&this.mostrarConsejoBanda(t.mensaje,t.tipo)}mostrarConsejoBanda(e,t){const a=document.getElementById("tipsDinamicos");if(!a)return;a.querySelectorAll('[data-tipo="banda-tc"]').forEach(e=>e.remove());const i=document.createElement("div");i.className=`tip-card ${t}`,i.setAttribute("data-tipo","banda-tc"),i.innerHTML=`\n            <span class="tip-icon">${"warning"===t?"‚ö†Ô∏è":"üí°"}</span>\n            <div class="tip-content">${e}</div>\n        `,a.insertBefore(i,a.firstChild),setTimeout(()=>{i.parentNode&&i.remove()},8e3)}configurarSliders(){const e=document.getElementById("plazo"),t=document.getElementById("plazoValor"),a=document.getElementById("tasaInteres"),i=document.getElementById("tasaValor");if(e&&t){let a=e.value;e.addEventListener("input",e=>{t.textContent=e.target.value,clearTimeout(this.plazoTimeout),this.plazoTimeout=setTimeout(()=>{this.recalcularCoreConNuevoTC(this.exchangeRateService.getTipoCambioSimulador())},300),a=e.target.value})}if(a&&i){let e=a.value;a.addEventListener("input",t=>{i.textContent=t.target.value,clearTimeout(this.tasaTimeout),this.tasaTimeout=setTimeout(()=>{this.recalcularCoreConNuevoTC(this.exchangeRateService.getTipoCambioSimulador())},300),e=t.target.value})}}actualizarBandasEnInterfaz(){const e={oficial:document.getElementById("tcOficial"),piso:document.getElementById("tcPiso"),techo:document.getElementById("tcTecho")},t=this.exchangeRateService.calcularBandasCambiarias();e.oficial&&(e.oficial.textContent=this.utilityService.formatearPesos(this.exchangeRateService.getTipoCambioOficial())),e.piso&&(e.piso.textContent=this.utilityService.formatearPesos(t.piso)),e.techo&&(e.techo.textContent=this.utilityService.formatearPesos(t.techo)),console.log("Bandas cambiarias configuradas:",{piso:t.piso,techo:t.techo,ancho:t.techo-t.piso,mesesTranscurridos:t.mesesTranscurridos})}}"undefined"!=typeof module&&module.exports?module.exports=SimulatorController:window.SimulatorController=SimulatorController;